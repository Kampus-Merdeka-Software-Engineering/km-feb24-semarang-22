<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart Example</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <input type="month" id="month-select-1" value="2015-01">
    <input type="month" id="month-select-2" value="2015-12">
    <button id="confirm-button">Confirm</button>
    <canvas id="chart"></canvas>

    <script>
        const ctx1 = document.getElementById('chart').getContext('2d');
        let myChart1;

        document.getElementById('confirm-button').addEventListener('click', () => {
            const startDate = new Date(document.getElementById('month-select-1').value);
            const endDate = new Date(document.getElementById('month-select-2').value);
            fetchNewDataAndCreateChart(startDate, endDate);
        });

        function fetchNewDataAndCreateChart(startDate, endDate) {
            fetch("/json/BusyTimeNew.json")
                .then(response => response.json())
                .then(data => {
                    const filteredData = filterDataByDateRange(data, startDate, endDate);
                    createNewBusyTimeChart(filteredData);
                });
        }

        function filterDataByDateRange(data, startDate, endDate) {
            const result = {};

            data.forEach(row => {
                const date = new Date(row.bulan); // Assuming `date` field is in your data
                if (date >= startDate && date <= endDate) {
                    if (!result[row.shift_waktu]) {
                        result[row.shift_waktu] = 0;
                    }
                    result[row.shift_waktu] += row.total_order;
                }
            });

            return Object.keys(result).map(shift_waktu => ({
                shift_waktu,
                total_order: result[shift_waktu]
            }));
        }

        function createNewBusyTimeChart(data) {
            if (myChart1) {
                myChart1.destroy(); // Destroy the previous chart if it exists
            }
            myChart1 = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: data.map(row => row.shift_waktu),
                    datasets: [{
                        label: 'Total Order',
                        data: data.map(row => row.total_order),
                        borderWidth: 1,
                        backgroundColor: [
                            '#332e2c',
                            '#3d493e',
                            '#4a5540',
                            '#556038',
                            '#616d33',
                        ],
                        hoverBackgroundColor: "#d4ba88",
                        hoverBorderColor: "#663300",
                    }]
                },
                options: {
                    indexAxis: 'y',
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    responsive: true,
                    maintainAspectRatio: false,
                }
            });
        }
    </script>
</body>
</html>
